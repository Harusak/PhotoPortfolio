<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>{{ page.title }} | {{ site.title }}</title>
  <!-- Tailwind CSS を CDN 経由で読み込み -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- レスポンシブ対応のメタタグ -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body.dark {
      background-color: #313131;
      color: #f3f4f6;
    }
    body.light {
      background-color: #f3f4f6;
      color: #1f2937;
    }
    #image-container {
      position: fixed;
      z-index: 10;
      transition: all 0.3s ease-in-out;
    }
    #image-container.expanded {
      top: 1rem;
      left: 1rem;
      right: 1rem;
      height: calc(40vh - 2rem);
    }
    #image-container.shrinked {
      top: 1rem;
      right: 1rem;
      width: 33.3333%;
      max-width: 24rem;
      aspect-ratio: 16 / 9;
      height: auto;
    }
    #image-overlay {
      position: absolute;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.3);
      transition: background-color 0.3s ease-in-out;
    }
    #image-wrapper {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
      border-radius: 1.5rem;
      box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      transition: all 0.3s ease-in-out;
    }
    #image-wrapper.backdrop {
      backdrop-filter: blur(4px);
      background-opacity: 0.7;
    }
    #content {
      position: relative;
      z-index: 0;
      height: 100%;
      overflow-y: auto;
      padding-top: calc(40vh + 1rem);
      padding-bottom: 4rem;
    }
    /* ナビゲーションバーのスタイル */
    nav {
      position: fixed;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 0.5rem;
      background-color: rgba(255, 255, 255, 0.7);
      border-radius: 9999px;
      box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(4px);
      z-index: 10;
    }
    body.dark nav {
      background-color: rgba(49, 49, 49, 0.7);
    }
    nav .button {
      padding: 0.5rem;
      margin: 0 0.5rem;
      border-radius: 9999px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: inherit;
      background-color: transparent;
      transition: background-color 0.2s ease-in-out;
    }
    nav .button:hover {
      background-color: rgba(0, 0, 0, 0.1);
    }
    body.dark nav .button:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    nav .button.active {
      background-color: rgba(0, 0, 0, 0.2);
    }
    body.dark nav .button.active {
      background-color: rgba(255, 255, 255, 0.2);
    }
    nav .button svg {
      width: 1.5rem;
      height: 1.5rem;
    }
  </style>
</head>
<body id="body" class="h-screen flex flex-col {% if page.theme %}{{ page.theme }}{% else %}light{% endif %}">
  <main class="flex-1 relative overflow-hidden">
    <!-- 固定された画像コンテナ -->
    <div id="image-container" class="expanded">
      <!-- 画像ラッパー -->
      <div id="image-wrapper">
        <!-- 画像 -->
        <img src="{{ page.image }}" alt="{{ page.title }}" class="absolute inset-0 w-full h-full object-cover transition-opacity duration-500 ease-in-out">
        <div id="image-overlay"></div>
      </div>
    </div>
    <!-- スクロール可能なコンテンツエリア -->
    <div id="content">
      <!-- 記事コンテンツ -->
      <article class="bg-stone-50 dark:bg-stone-800 p-6 md:p-8 min-h-screen rounded-t-3xl">
        <!-- テキストコンテンツ -->
        <div class="prose dark:prose-invert max-w-none">
          <h1 class="text-3xl md:text-4xl font-bold mb-4">{{ page.title }}</h1>
          <p class="text-gray-600 dark:text-gray-400 mb-6">{{ page.date | date: "%Y年%-m月%-d日" }}</p>

          {{ content }}

        </div>
      </article>
    </div>
  </main>

  <!-- ナビゲーション -->
  {% include navigation.html %}

  <script>
    const btnPortfolio = document.getElementById('btn-portfolio');
    const btnBlog = document.getElementById('btn-blog');
    const btnAbout = document.getElementById('btn-about');
    const sections = {
      'portfolio': document.getElementById('portfolio'),
      'blog': document.getElementById('blog'),
      'about': document.getElementById('about')
    };
    let activePage = 'portfolio';

    function showPage(page) {
      // 全てのセクションを非表示
      for (const key in sections) {
        sections[key].style.display = 'none';
      }
      // 指定されたページを表示
      sections[page].style.display = page === 'about' ? 'block' : 'flex';
      activePage = page;
      updateActiveButton();
    }

    function updateActiveButton() {
      // 全てのボタンからactiveクラスを削除
      document.querySelectorAll('nav .button').forEach(btn => btn.classList.remove('active'));
      // アクティブなボタンにactiveクラスを追加
      if (activePage === 'portfolio') {
        btnPortfolio.classList.add('active');
      } else if (activePage === 'blog') {
        btnBlog.classList.add('active');
      } else if (activePage === 'about') {
        btnAbout.classList.add('active');
      }
    }

    btnPortfolio.addEventListener('click', () => showPage('portfolio'));
    btnBlog.addEventListener('click', () => showPage('blog'));
    btnAbout.addEventListener('click', () => showPage('about'));

    document.addEventListener('DOMContentLoaded', function() {
      // 状態変数
      let isDarkMode = {% if page.theme == 'dark' %}true{% else %}false{% endif %};
      let isImageExpanded = true;
      let scrollPosition = 0;

      // 要素の取得
      const body = document.getElementById('body');
      const imageContainer = document.getElementById('image-container');
      const imageWrapper = document.getElementById('image-wrapper');
      const imageOverlay = document.getElementById('image-overlay');
      const content = document.getElementById('content');
      const themeToggleButton = document.getElementById('theme-toggle');
      const iconMoon = document.getElementById('icon-moon');
      const iconSun = document.getElementById('icon-sun');

      // ローカルストレージからテーマを取得
      const savedTheme = localStorage.getItem('theme') || 'light';
      isDarkMode = (savedTheme === 'dark');
      updateTheme();

      // スクロールイベントのリスナー
      content.addEventListener('scroll', function() {
        scrollPosition = content.scrollTop;
        if (scrollPosition > 100 && isImageExpanded) {
          isImageExpanded = false;
          updateImageContainer();
        }
      });

      // 画像クリック時のイベントリスナー
      imageWrapper.addEventListener('click', function() {
        isImageExpanded = !isImageExpanded;
        updateImageContainer();
      });

      // テーマを更新する関数
      function updateTheme() {
        if (isDarkMode) {
          body.classList.remove('light');
          body.classList.add('dark');
          iconMoon.style.display = 'none';
          iconSun.style.display = 'block';
        } else {
          body.classList.remove('dark');
          body.classList.add('light');
          iconMoon.style.display = 'block';
          iconSun.style.display = 'none';
        }
        localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
      }

      // テーマを切り替える関数
      function toggleTheme() {
        isDarkMode = !isDarkMode;
        updateTheme();
      }

      // 画像コンテナを更新する関数
      function updateImageContainer() {
        if (isImageExpanded) {
          imageContainer.classList.remove('shrinked');
          imageContainer.classList.add('expanded');
          imageOverlay.style.backgroundColor = 'rgba(0, 0, 0, 0.3)';
          imageWrapper.classList.remove('backdrop');
        } else {
          imageContainer.classList.remove('expanded');
          imageContainer.classList.add('shrinked');
          imageOverlay.style.backgroundColor = 'rgba(0, 0, 0, 0.1)';
          imageWrapper.classList.add('backdrop');
          imageContainer.style.aspectRatio = '16 / 9';
          imageContainer.style.height = 'auto';
        }
      }

      // 初期化
      updateImageContainer();

      // テーマ切り替えボタンのイベントリスナー
      if (themeToggleButton) {
        themeToggleButton.addEventListener('click', toggleTheme);
      }
    });
  </script>
</body>
</html>
